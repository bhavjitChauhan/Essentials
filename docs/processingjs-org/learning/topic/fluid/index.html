<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>Processing.js</title>
    <link rel="stylesheet" href="/processingjs-org/css/bootstrap.css" type="text/css" />
    <link rel="stylesheet" href="/processingjs-org/css/syntax.css" type="text/css" />
    <link rel="stylesheet" href="/processingjs-org/css/processing-js.css" type="text/css" />
    <script src="/processingjs-org/js/processing.min.js" type="text/javascript"></script>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.6.4/jquery.min.js" type="text/javascript"></script>
    <script src="/processingjs-org/js/jquery.tweet.min.js" type="text/javascript"></script>
    <script src="/processingjs-org/js/tabselector.js" type="text/javascript"></script>
    <script src="http://cdn.webglstats.com/stat.js" defer="defer" async="async"></script>
    <script type="text/javascript">
      // Only do tracking on the actual site
      if (document.location.host === "processingjs.org") {
        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-8565070-1']);
        _gaq.push(['_trackPageview']);
        (function() {
          var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
          ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
          var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
        }());
      }
    </script>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <a href="/processingjs-org/"><img src="/processingjs-org/images/header.png" width="177" height="42"></a>
      </div>
      <span class="tagline">a port of the Processing Visualization Language</span>

      <div class="navbar">
        <canvas width="940px" height="78px" data-processing-sources="/processingjs-org/sketches/bannerSketch.pde"></canvas>
        <ul>
          <li><a href="/processingjs-org/"><span>home</span></a></li>
          <li><a href="/processingjs-org/download/"><span>download</span></a></li>
          <li><a href="/processingjs-org/reference/"><span>reference</span></a></li>
          <li><a href="/processingjs-org/exhibition/"><span>exhibition</span></a></li>
          <li><a href="/processingjs-org/learning/"><span>learning</span></a></li>
          <li><a href="/processingjs-org/articles/"><span>articles</span></a></li>
          <li><a href="/processingjs-org/community/"><span>community</span></a></li>
          <li><a href="/processingjs-org/blog/"><span>blog</span></a></li>
        </ul>
        <a class="viewsource" href="/processingjs-org/sketches/bannerSketch.pde">view source</a>
      </div>

      <div class="page row">
        <div class="span11">
<h3>Fluid</h3>



<p>by Glen Murphy. 



Click and drag the mouse to move the simulated fluid.

Adjust the "res" variable below to change resolution.

Code has not been optimised, and will run fairly slowly.



Completed 5 November 2002</p>



<p><a href="http://processing.org/learning/topics/fluid.html"><b>Original Processing.org Example:</b> Fluid</a><br>

<div class="learning-demo"><script type="application/processing">

int res = 2;

int penSize = 30;

int lwidth;

int lheight;

int pnum = 30000;

vsquare[][] v;

vbuffer[][] vbuf;

particle[] p = new particle[pnum];

int pcount = 0;

int mouseXvel = 0;

int mouseYvel = 0;



void setup() 

{

  size(200,200);

  noStroke();

  frameRate(30);

  lwidth = width/res;

  lheight = height/res;

  v = new vsquare[lwidth+1][lheight+1];

  vbuf = new vbuffer[lwidth+1][lheight+1];

  for (int i = 0; i < pnum; i++) {

    p[i] = new particle(random(res,width-res),random(res,height-res));

  }

  for (int i = 0; i <= lwidth; i++) {

    for (int u = 0; u <= lheight; u++) {

      v[i][u] = new vsquare(i*res,u*res);

      vbuf[i][u] = new vbuffer(i*res,u*res);

    }

  }

}



void draw() 

{

  background(#666666);

  

  int axvel = mouseX-pmouseX;

  int ayvel = mouseY-pmouseY;



  mouseXvel = (axvel != mouseXvel) ? axvel : 0;

  mouseYvel = (ayvel != mouseYvel) ? ayvel : 0;



  for (int i = 0; i < lwidth; i++) {

    for (int u = 0; u < lheight; u++) {

      vbuf[i][u].updatebuf(i,u);

      v[i][u].col = 32;

    }

  }

  for (int i = 0; i < pnum-1; i++) {

    p[i].updatepos();

  }

  for (int i = 0; i < lwidth; i++) {

    for (int u = 0; u < lheight; u++) {

      v[i][u].addbuffer(i, u);

      v[i][u].updatevels(mouseXvel, mouseYvel);

      v[i][u].display(i, u);

    }

  }

}



class particle {

  float x;

  float y;

  float xvel;

  float yvel;

  int pos;

  particle(float xIn, float yIn) {

    x = xIn;

    y = yIn;

  }



  void updatepos() {

    float col1;

    if (x > 0 && x < width && y > 0 && y < height) {

      int vi = (int)(x/res);

      int vu = (int)(y/res);

      vsquare o = v[vi][vu];    

      

      float ax = (x%res)/res;

      float ay = (y%res)/res;

      

      xvel += (1-ax)*v[vi][vu].xvel*0.05;

      yvel += (1-ay)*v[vi][vu].yvel*0.05;

      

      xvel += ax*v[vi+1][vu].xvel*0.05;

      yvel += ax*v[vi+1][vu].yvel*0.05;

      

      xvel += ay*v[vi][vu+1].xvel*0.05;

      yvel += ay*v[vi][vu+1].yvel*0.05;



      o.col += 4;

      

      x += xvel;

      y += yvel;

    }

    else {

      x = random(0,width);

      y = random(0,height);

      xvel = 0;

      yvel = 0;

    }



    xvel *= 0.5;

    yvel *= 0.5;

  }

}



class vbuffer {

  int x;

  int y;

  float xvel;

  float yvel;

  float pressurex = 0;

  float pressurey = 0;

  float pressure = 0;



  vbuffer(int xIn,int yIn) {

    x = xIn;

    y = yIn;

    pressurex = 0;

    pressurey = 0;

    }



  void updatebuf(int i, int u) {

    if (i>0 && i<lwidth && u>0 && u<lheight) {

      pressurex = (v[i-1][u-1].xvel*0.5 + v[i-1][u].xvel + v[i-1][u+1].xvel*0.5 - v[i+1][u-1].xvel*0.5 - v[i+1][u].xvel - v[i+1][u+1].xvel*0.5);

      pressurey = (v[i-1][u-1].yvel*0.5 + v[i][u-1].yvel + v[i+1][u-1].yvel*0.5 - v[i-1][u+1].yvel*0.5 - v[i][u+1].yvel - v[i+1][u+1].yvel*0.5);

      pressure = (pressurex + pressurey)*0.25;

      }

    }

  }



class vsquare {

  int x;

  int y;

  float xvel;

  float yvel;

  float col;



  vsquare(int xIn,int yIn) {

    x = xIn;

    y = yIn;

    }



  void addbuffer(int i, int u) {

    if (i>0 && i<lwidth && u>0 && u<lheight) {

      xvel += (vbuf[i-1][u-1].pressure*0.5

              +vbuf[i-1][u].pressure

              +vbuf[i-1][u+1].pressure*0.5

              -vbuf[i+1][u-1].pressure*0.5

              -vbuf[i+1][u].pressure

              -vbuf[i+1][u+1].pressure*0.5

              )*0.25;

      yvel += (vbuf[i-1][u-1].pressure*0.5

              +vbuf[i][u-1].pressure

              +vbuf[i+1][u-1].pressure*0.5

              -vbuf[i-1][u+1].pressure*0.5

              -vbuf[i][u+1].pressure

              -vbuf[i+1][u+1].pressure*0.5

              )*0.25;

      }

    }



  void updatevels(int mvelX, int mvelY) {

    if (mousePressed) {

      float adj = x - mouseX;

      float opp = y - mouseY;

      float dist = sqrt(opp*opp + adj*adj);

      if (dist < penSize) {

        if (dist < 4) dist = penSize;

        float mod = penSize/dist;

        xvel += mvelX*mod;

        yvel += mvelY*mod;

        }

      }



    xvel *= 0.99;

    yvel *= 0.99;

  }

  

  void display(int i, int u) {

    float tcol = 0;

    if (col > 255) col = 255;

    if (i>0 && i<lwidth-1 && u>0 && u<lheight-1) {

      tcol = (+ v[i][u+1].col 

              + v[i+1][u].col 

              + v[i+1][u+1].col*0.5

              )*0.4;

      tcol = (int)(tcol+col*0.5);

      }

    else {

      tcol = (int)col;

      }

    fill(tcol, tcol, tcol);

    rect(x,y,res,res);

  }

}

</script><canvas width="200" height="200"></canvas></div></p>

<div style="height:0px;width:0px;overflow:hidden;"></div>



<div class="code"><pre name="code" class="processing">// All Examples Written by Casey Reas and Ben Fry

// unless otherwise stated.

int res = 2;

int penSize = 30;

int lwidth;

int lheight;

int pnum = 30000;

vsquare[][] v;

vbuffer[][] vbuf;

particle[] p = new particle[pnum];

int pcount = 0;

int mouseXvel = 0;

int mouseYvel = 0;



void setup() 

{

  size(200,200);

  noStroke();

  frameRate(30);

  lwidth = width/res;

  lheight = height/res;

  v = new vsquare[lwidth+1][lheight+1];

  vbuf = new vbuffer[lwidth+1][lheight+1];

  for (int i = 0; i &lt; pnum; i++) {

    p[i] = new particle(random(res,width-res),random(res,height-res));

  }

  for (int i = 0; i &lt;= lwidth; i++) {

    for (int u = 0; u &lt;= lheight; u++) {

      v[i][u] = new vsquare(i*res,u*res);

      vbuf[i][u] = new vbuffer(i*res,u*res);

    }

  }

}



void draw() 

{

  background(#666666);

  

  int axvel = mouseX-pmouseX;

  int ayvel = mouseY-pmouseY;



  mouseXvel = (axvel != mouseXvel) ? axvel : 0;

  mouseYvel = (ayvel != mouseYvel) ? ayvel : 0;



  for (int i = 0; i &lt; lwidth; i++) {

    for (int u = 0; u &lt; lheight; u++) {

      vbuf[i][u].updatebuf(i,u);

      v[i][u].col = 32;

    }

  }

  for (int i = 0; i &lt; pnum-1; i++) {

    p[i].updatepos();

  }

  for (int i = 0; i &lt; lwidth; i++) {

    for (int u = 0; u &lt; lheight; u++) {

      v[i][u].addbuffer(i, u);

      v[i][u].updatevels(mouseXvel, mouseYvel);

      v[i][u].display(i, u);

    }

  }

}



class particle {

  float x;

  float y;

  float xvel;

  float yvel;

  int pos;

  particle(float xIn, float yIn) {

    x = xIn;

    y = yIn;

  }



  void updatepos() {

    float col1;

    if (x &gt; 0 && x &lt; width && y &gt; 0 && y &lt; height) {

      int vi = (int)(x/res);

      int vu = (int)(y/res);

      vsquare o = v[vi][vu];    

      

      float ax = (x%res)/res;

      float ay = (y%res)/res;

      

      xvel += (1-ax)*v[vi][vu].xvel*0.05;

      yvel += (1-ay)*v[vi][vu].yvel*0.05;

      

      xvel += ax*v[vi+1][vu].xvel*0.05;

      yvel += ax*v[vi+1][vu].yvel*0.05;

      

      xvel += ay*v[vi][vu+1].xvel*0.05;

      yvel += ay*v[vi][vu+1].yvel*0.05;



      o.col += 4;

      

      x += xvel;

      y += yvel;

    }

    else {

      x = random(0,width);

      y = random(0,height);

      xvel = 0;

      yvel = 0;

    }



    xvel *= 0.5;

    yvel *= 0.5;

  }

}



class vbuffer {

  int x;

  int y;

  float xvel;

  float yvel;

  float pressurex = 0;

  float pressurey = 0;

  float pressure = 0;



  vbuffer(int xIn,int yIn) {

    x = xIn;

    y = yIn;

    pressurex = 0;

    pressurey = 0;

    }



  void updatebuf(int i, int u) {

    if (i&gt;0 && i&lt;lwidth && u&gt;0 && u&lt;lheight) {

      pressurex = (v[i-1][u-1].xvel*0.5 + v[i-1][u].xvel + v[i-1][u+1].xvel*0.5 - v[i+1][u-1].xvel*0.5 - v[i+1][u].xvel - v[i+1][u+1].xvel*0.5);

      pressurey = (v[i-1][u-1].yvel*0.5 + v[i][u-1].yvel + v[i+1][u-1].yvel*0.5 - v[i-1][u+1].yvel*0.5 - v[i][u+1].yvel - v[i+1][u+1].yvel*0.5);

      pressure = (pressurex + pressurey)*0.25;

      }

    }

  }



class vsquare {

  int x;

  int y;

  float xvel;

  float yvel;

  float col;



  vsquare(int xIn,int yIn) {

    x = xIn;

    y = yIn;

    }



  void addbuffer(int i, int u) {

    if (i&gt;0 && i&lt;lwidth && u&gt;0 && u&lt;lheight) {

      xvel += (vbuf[i-1][u-1].pressure*0.5

              +vbuf[i-1][u].pressure

              +vbuf[i-1][u+1].pressure*0.5

              -vbuf[i+1][u-1].pressure*0.5

              -vbuf[i+1][u].pressure

              -vbuf[i+1][u+1].pressure*0.5

              )*0.25;

      yvel += (vbuf[i-1][u-1].pressure*0.5

              +vbuf[i][u-1].pressure

              +vbuf[i+1][u-1].pressure*0.5

              -vbuf[i-1][u+1].pressure*0.5

              -vbuf[i][u+1].pressure

              -vbuf[i+1][u+1].pressure*0.5

              )*0.25;

      }

    }



  void updatevels(int mvelX, int mvelY) {

    if (mousePressed) {

      float adj = x - mouseX;

      float opp = y - mouseY;

      float dist = sqrt(opp*opp + adj*adj);

      if (dist &lt; penSize) {

        if (dist &lt; 4) dist = penSize;

        float mod = penSize/dist;

        xvel += mvelX*mod;

        yvel += mvelY*mod;

        }

      }



    xvel *= 0.99;

    yvel *= 0.99;

  }

  

  void display(int i, int u) {

    float tcol = 0;

    if (col &gt; 255) col = 255;

    if (i&gt;0 && i&lt;lwidth-1 && u&gt;0 && u&lt;lheight-1) {

      tcol = (+ v[i][u+1].col 

              + v[i+1][u].col 

              + v[i+1][u+1].col*0.5

              )*0.4;

      tcol = (int)(tcol+col*0.5);

      }

    else {

      tcol = (int)col;

      }

    fill(tcol, tcol, tcol);

    rect(x,y,res,res);

  }

}</pre></div>






        </div>
        <div class="sidebar span4">
          <h3><a href="/processingjs-org/download/">Downloads</a></h3>
          <ul>
            <li><a href="/processingjs-org/download/">Download the latest version of Processing.js!</a></li>
          </ul>

          <h3><a href="/processingjs-org/articles/">Articles</a></h3>
          <ul>
            <li><a href="/processingjs-org/articles/jsQuickStart.html">Quick Start - JavaScript Developer</a></li>
            <li><a href="/processingjs-org/articles/p5QuickStart.html">Quick Start - Processing Developer</a></li>
            <li><a href="/processingjs-org/articles/RenderingModes.html">Rendering Modes</a></li>
            <li><a href="/processingjs-org/articles/PomaxGuide.html">Pomax's Guide to processing-js</a></li>
          </ul>

          <h3><a>Web IDEs</a></h3>
          <ul>
            <li><a href="http://sketchpad.cc">Sketchpad.cc</a></li>
            <li><a href="/processingjs-org/tools/processing-helper.html">Processing.js Helper</a></li>
            <li><a href="http://www.openprocessing.org">OpenProcessing.org</a></li>
          </ul>

          <h3><a href="/processingjs-org/community/">Community</a></h3>
          <ul>
            <li><a href="irc://irc.mozilla.org/processing.js">IRC Channel</a></li>
            <li><a href="http://processing-js.lighthouseapp.com/">Bug Tracker</a></li>
            <li><a href="http://github.com/processing-js/processing-js/">Github Repository</a></li>
            <li><a href="http://groups.google.com/group/processingjs">Google Group</a></li>
            <li><a href="http://zenit.senecac.on.ca/wiki/index.php/">Open Source @ Seneca</a></li>
          </ul>

          <h3><a href="http://twitter.com/processingjs">Twitter Feed</a></h3>
          <div class="twitter"></div>
        </div>
      </div>

      <div class="footer">
        Processing is an open visualization language developed by
        <a href="http://benfry.com/">Ben Fry</a> &amp; <a href="http://reas.com/">Casey Reas</a>,
        and originally ported to Javascript by
        <a href="http://ejohn.org/blog/processingjs/">John Resig</a>.
        Processing.js is maintained by the Processing.js team.
      </div>
    </div>
    <a href="http://github.com/processing-js/processing-js/">
      <img style="position: absolute; top: 0; right: 0; border: 0;" src="/processingjs-org/images/forkme-right-orange.png" alt="Fork me on GitHub">
    </a>
  </body>
</html>
