<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>Processing.js</title>
    <link rel="stylesheet" href="/Essentials/processingjs-org/css/bootstrap.css" type="text/css" />
    <link rel="stylesheet" href="/Essentials/processingjs-org/css/syntax.css" type="text/css" />
    <link rel="stylesheet" href="/Essentials/processingjs-org/css/processing-js.css" type="text/css" />
    <script src="/Essentials/processingjs-org/js/processing.min.js" type="text/javascript"></script>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.6.4/jquery.min.js" type="text/javascript"></script>
    <script src="/Essentials/processingjs-org/js/jquery.tweet.min.js" type="text/javascript"></script>
    <script src="/Essentials/processingjs-org/js/tabselector.js" type="text/javascript"></script>
    <script src="http://cdn.webglstats.com/stat.js" defer="defer" async="async"></script>
    <script type="text/javascript">
      // Only do tracking on the actual site
      if (document.location.host === "processingjs.org") {
        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-8565070-1']);
        _gaq.push(['_trackPageview']);
        (function() {
          var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
          ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
          var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
        }());
      }
    </script>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <a href="/Essentials/processingjs-org/"><img src="/Essentials/processingjs-org/images/header.png" width="177" height="42"></a>
      </div>
      <span class="tagline">a port of the Processing Visualization Language</span>

      <div class="navbar">
        <canvas width="940px" height="78px" data-processing-sources="/Essentials/processingjs-org/sketches/bannerSketch.pde"></canvas>
        <ul>
          <li><a href="/Essentials/processingjs-org/"><span>home</span></a></li>
          <li><a href="/Essentials/processingjs-org/download/"><span>download</span></a></li>
          <li><a href="/Essentials/processingjs-org/reference/"><span>reference</span></a></li>
          <li><a href="/Essentials/processingjs-org/exhibition/"><span>exhibition</span></a></li>
          <li><a href="/Essentials/processingjs-org/learning/"><span>learning</span></a></li>
          <li><a href="/Essentials/processingjs-org/articles/"><span>articles</span></a></li>
          <li><a href="/Essentials/processingjs-org/community/"><span>community</span></a></li>
          <li><a href="/Essentials/processingjs-org/blog/"><span>blog</span></a></li>
        </ul>
        <a class="viewsource" href="/Essentials/processingjs-org/sketches/bannerSketch.pde">view source</a>
      </div>

      <div class="page row">
        <div class="span11">
<h3>Molten Bar Chart</h3>

<p>A dynamically-generated bar chart. Move mouse to view dynamic pie chart.</p>

<p><a href="http://ejohn.org/">Molten Bar Chart</a><br>
<div class="learning-demo px580x150"><script type="application/processing">
int xspacing = 16;   // How far apart should each horizontal location be spaced
int w;              // Width of entire wave
int maxwaves = 4;   // total # of waves to add together
int total = 0;

float theta = 0.0f;
float[] amplitude = new float[maxwaves];   // Height of wave
float[] dx = new float[maxwaves];          // Value for incrementing X, to be calculated as a function of period and xspacing
float[] yvalues;                           // Using an array to store height values for the wave (not entirely necessary)
float[] last;

int pos;
int rel;
int numLines;
int idealLines;
int idealSpacing;
int targetX;

void setup() {
  size(580, 150);
  //frameRate(24);
  colorMode(RGB,255,255,255,100);
  //background(0);
  smooth();
  w = width+16;

  for (int i = 0; i < maxwaves; i++) {
    amplitude[i] = random(20,30);
    float period = random(100,300); // How many pixels before the wave repeats
    dx[i] = (TWO_PI / period) * xspacing;
  }

  last = new float[maxwaves];
  idealLines = numLines = int(w/xspacing);
  idealSpacing = xspacing;
  yvalues = new float[numLines];
}

void draw() {
  pos = constrain(mouseX, 75, width-75);
  rel = 1 - ((pos - 75) / (width - 150));
  
  //background(0);
  fill(0, 10 + ((1 - rel) * 100));
  rect(0, 0, width, height);
  
  //numLines = idealLines + ((1 - rel) * idealLines);
  //xspacing = idealSpacing - (((1 - rel) * idealSpacing) / 2);
  
  calcWave();
  renderWave();
  renderChart();
}

void calcWave() {
  // Increment theta (try different values for 'angular velocity' here
  theta += 0.02;

  // Set all height values to zero
  for (int i = 0; i < numLines; i++) {
    yvalues[i] = 0.0f;
  }
  
  total = 0;
 
  // Accumulate wave height values
  for (int j = 0; j < maxwaves; j++) {
    float x = theta;
    last[j] = 0;
    
    for (int i = 0; i < numLines; i++) {
      // Every other wave is cosine instead of sine
      int diff = j % 2 == 0 ? sin(x) : cos(x);
      int add = diff*amplitude[j];
      
      last[j] += add;
      
      yvalues[i] += add;
      
      total += add;
      
      x+=dx[j]; // - (((1 - rel) * dx[j]) / 2);
    }
  }
}

void renderWave() {
  noStroke();
  
  fill(254,60,0, 120 * rel);
  beginShape();
  vertex(0,height);
  for (int x = 0; x < numLines; x++) {
    vertex(x*xspacing,height/2+yvalues[x]+-5);
    vertex((x*xspacing) + 10,height/2+yvalues[x]-5);
  }
  vertex(width,height);
  endShape(CLOSE);
  
  fill(255,0,0, 120 * rel);
  beginShape();
  vertex(0,height);
  for (int x = 0; x < numLines; x++) {
    vertex(x*xspacing,height/2+yvalues[x]);
    vertex((x*xspacing) + 10,height/2+yvalues[x]);
  }
  vertex(width,height);
  endShape(CLOSE);
  
  //fill(255,0,0,255 - ((x/numLines)*200));
  //rect(x*xspacing,height/2+yvalues[x],10,height*2);
  // - ((1-rel) * 4)
  
  for (int x = 0; x < numLines; x++) {
    fill(255,0,0,255 - ((x/numLines)*200));
    rect(x*xspacing,height/2+yvalues[x],10,height*2);
    // - ((1-rel) * 4)
  }
}

void renderChart() {
  int h = 0;
  
  for (int i=0; i<last.length; i++){
    last[i] = Math.abs(last[i]);
    h += last[i];
  }
  
  int lastAng = 0;
  int tmprel = 1 - rel;
  
  for (int i=0; i<last.length; i++){
    int pct = (last[i] / h) * 360;
    stroke(0, 100 * tmprel);
    fill(255, 255/(i+1), 0, 200 * tmprel);
    arc(pos, 75, 225 * tmprel, 225 * tmprel, lastAng, lastAng+radians(pct));
    lastAng += radians(pct);  
  }
}
</script><canvas width="600" height="150"></canvas></div></p>
<div style="height:0px;width:0px;overflow:hidden;"></div>

<div class="code"><pre name="code" class="processing"> int xspacing = 16;   // How far apart should each horizontal location be spaced
int w;              // Width of entire wave
int maxwaves = 4;   // total # of waves to add together
int total = 0;

float theta = 0.0f;
float[] amplitude = new float[maxwaves];   // Height of wave
float[] dx = new float[maxwaves];          // Value for incrementing X, to be calculated as a function of period and xspacing
float[] yvalues;                           // Using an array to store height values for the wave (not entirely necessary)
float[] last;

int pos;
int rel;
int numLines;
int idealLines;
int idealSpacing;
int targetX;

void setup() {
  size(600, 150);
  //frameRate(24);
  colorMode(RGB,255,255,255,100);
  //background(0);
  smooth();
  w = width+16;

  for (int i = 0; i < maxwaves; i++) {
    amplitude[i] = random(20,30);
    float period = random(100,300); // How many pixels before the wave repeats
    dx[i] = (TWO_PI / period) * xspacing;
  }

  last = new float[maxwaves];
  idealLines = numLines = int(w/xspacing);
  idealSpacing = xspacing;
  yvalues = new float[numLines];
}

void draw() {
  pos = constrain(mouseX, 75, width-75);
  rel = 1 - ((pos - 75) / (width - 150));
  
  //background(0);
  fill(0, 10 + ((1 - rel) * 100));
  rect(0, 0, width, height);
  
  //numLines = idealLines + ((1 - rel) * idealLines);
  //xspacing = idealSpacing - (((1 - rel) * idealSpacing) / 2);
  
  calcWave();
  renderWave();
  renderChart();
}

void calcWave() {
  // Increment theta (try different values for 'angular velocity' here
  theta += 0.02;

  // Set all height values to zero
  for (int i = 0; i < numLines; i++) {
    yvalues[i] = 0.0f;
  }
  
  total = 0;
 
  // Accumulate wave height values
  for (int j = 0; j < maxwaves; j++) {
    float x = theta;
    last[j] = 0;
    
    for (int i = 0; i < numLines; i++) {
      // Every other wave is cosine instead of sine
      int diff = j % 2 == 0 ? sin(x) : cos(x);
      int add = diff*amplitude[j];
      
      last[j] += add;
      
      yvalues[i] += add;
      
      total += add;
      
      x+=dx[j]; // - (((1 - rel) * dx[j]) / 2);
    }
  }
}

void renderWave() {
  noStroke();
  
  fill(254,60,0, 120 * rel);
  beginShape();
  vertex(0,height);
  for (int x = 0; x < numLines; x++) {
    vertex(x*xspacing,height/2+yvalues[x]+-5);
    vertex((x*xspacing) + 10,height/2+yvalues[x]-5);
  }
  vertex(width,height);
  endShape(CLOSE);
  
  fill(255,0,0, 120 * rel);
  beginShape();
  vertex(0,height);
  for (int x = 0; x < numLines; x++) {
    vertex(x*xspacing,height/2+yvalues[x]);
    vertex((x*xspacing) + 10,height/2+yvalues[x]);
  }
  vertex(width,height);
  endShape(CLOSE);
  
  //fill(255,0,0,255 - ((x/numLines)*200));
  //rect(x*xspacing,height/2+yvalues[x],10,height*2);
  // - ((1-rel) * 4)
  
  for (int x = 0; x < numLines; x++) {
    fill(255,0,0,255 - ((x/numLines)*200));
    rect(x*xspacing,height/2+yvalues[x],10,height*2);
    // - ((1-rel) * 4)
  }
}

void renderChart() {
  int h = 0;
  
  for (int i=0; i<last.length; i++){
    last[i] = Math.abs(last[i]);
    h += last[i];
  }
  
  int lastAng = 0;
  int tmprel = 1 - rel;
  
  for (int i=0; i < last.length; i++){
    int pct = (last[i] / h) * 360;
    stroke(0, 100 * tmprel);
    fill(255, 255/(i+1), 0, 200 * tmprel);
    arc(pos, 75, 225 * tmprel, 225 * tmprel, lastAng, lastAng+radians(pct));
    lastAng += radians(pct);  
  }
}</pre></div>



        </div>
        <div class="sidebar span4">
          <h3><a href="/Essentials/processingjs-org/download/">Downloads</a></h3>
          <ul>
            <li><a href="/Essentials/processingjs-org/download/">Download the latest version of Processing.js!</a></li>
          </ul>

          <h3><a href="/Essentials/processingjs-org/articles/">Articles</a></h3>
          <ul>
            <li><a href="/Essentials/processingjs-org/articles/jsQuickStart.html">Quick Start - JavaScript Developer</a></li>
            <li><a href="/Essentials/processingjs-org/articles/p5QuickStart.html">Quick Start - Processing Developer</a></li>
            <li><a href="/Essentials/processingjs-org/articles/RenderingModes.html">Rendering Modes</a></li>
            <li><a href="/Essentials/processingjs-org/articles/PomaxGuide.html">Pomax's Guide to processing-js</a></li>
          </ul>

          <h3><a>Web IDEs</a></h3>
          <ul>
            <li><a href="http://sketchpad.cc">Sketchpad.cc</a></li>
            <li><a href="/Essentials/processingjs-org/tools/processing-helper.html">Processing.js Helper</a></li>
            <li><a href="http://www.openprocessing.org">OpenProcessing.org</a></li>
          </ul>

          <h3><a href="/Essentials/processingjs-org/community/">Community</a></h3>
          <ul>
            <li><a href="irc://irc.mozilla.org/processing.js">IRC Channel</a></li>
            <li><a href="http://processing-js.lighthouseapp.com/">Bug Tracker</a></li>
            <li><a href="http://github.com/processing-js/processing-js/">Github Repository</a></li>
            <li><a href="http://groups.google.com/group/processingjs">Google Group</a></li>
            <li><a href="http://zenit.senecac.on.ca/wiki/index.php/">Open Source @ Seneca</a></li>
          </ul>

          <h3><a href="http://twitter.com/processingjs">Twitter Feed</a></h3>
          <div class="twitter"></div>
        </div>
      </div>

      <div class="footer">
        Processing is an open visualization language developed by
        <a href="http://benfry.com/">Ben Fry</a> &amp; <a href="http://reas.com/">Casey Reas</a>,
        and originally ported to Javascript by
        <a href="http://ejohn.org/blog/processingjs/">John Resig</a>.
        Processing.js is maintained by the Processing.js team.
      </div>
    </div>
    <a href="http://github.com/processing-js/processing-js/">
      <img style="position: absolute; top: 0; right: 0; border: 0;" src="/Essentials/processingjs-org/images/forkme-right-orange.png" alt="Fork me on GitHub">
    </a>
  </body>
</html>
