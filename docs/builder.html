<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name=description content="Package builder for the Essentials library.">

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1/font/bootstrap-icons.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@10/styles/default.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1/themes/prism-tomorrow.min.css">
    <style>
        label {
            cursor: pointer;
        }
    </style>
    <title>Essentials Builder</title>
</head>

<body>
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">Essentials Builder</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
                aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link" href="https://github.com/bhavjitChauhan/Essentials"
                            target="_blank">GitHub</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="https://bhavjitchauhan.github.io/Essentials/"
                            target="_blank">Documentation</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="https://github.com/bhavjitChauhan/Essentials/wiki"
                            target="_blank">Wiki</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link"
                            href="https://www.jsdelivr.com/package/gh/bhavjitChauhan/Essentials?path=build"
                            target="_blank">jsDelivr</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
    <div class="container">
        <br>
        <div id="alert" class="alert alert-success alert-dismissible fade show" role="alert" style="display: none;">
            The code has been copied to your clipboard.
            <button type="button" class="btn-close" aria-label="Close" onclick="$('#alert').hide();"></button>
        </div>
        <div class="row mt-3">
            <h2>About</h2>
            <p>
                The Essentials library provides utility functions for the
                Khan Academy Processing Environment. Use the navigation link
                above to explore relevant pages.
            </p>
            <p>
                For more information on build differences, see the
                <a href="https://github.com/bhavjitChauhan/Essentials/wiki/Custom-Builds" target="_blank">Custom
                    Builds</a>
                page on the wiki.
            </p>
        </div>
        <div class="row mt-3">
            <h2>Usage</h2>
            <p>
                Select the Build Type and what components of the Essentials
                library you need, then click the Submit button for your
                generated code.
            </p>
            <p>
                The included JSHint directive must be present before any
                Essentials code, see the wiki on
                <a href="https://github.com/bhavjitChauhan/Essentials/wiki/JSHint" target="_blank">JSHint</a>
                for more information.
            </p>
        </div>
        <div class="row mt-3 my-5">
            <h2>Build</h2>
            <div class="col-8 mt-4">
                <form id="form">
                    <div class="mb-3">
                        <h4>Type</h4>
                        <select class="form-select" id="buildTypeSelect">
                            <option value="CDN" selected>
                                Content Delivery Network
                            </option>
                            <option value="KA">
                                Khan Academy
                            </option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <h4>Components</h4>
                        <div class="list-group">
                            <label class="list-group-item list-group-item-action active">
                                <input id="coreCheckbox" class="form-check-input me-1" type="checkbox" checked hidden
                                    disabled>
                                <h6 class="mb-1">Essentials Core</h6>
                                <p class="mb-1">Core functionality. Required for other components.</p>
                            </label>
                            <label class="list-group-item list-group-item-action active">
                                <input id="colorCheckbox" class="form-check-input me-1" type="checkbox" checked hidden>
                                <h6 class="mb-1">Color Essentials</h6>
                                <p class="mb-1">Color variables, conversion and gradient functions. Required by Text
                                    Essentials.</p>
                            </label>
                            <label class="list-group-item list-group-item-action active">
                                <input id="textCheckbox" class="form-check-input me-1" type="checkbox" checked hidden>
                                <h6 class="mb-1">Text Essentials</h6>
                                <p class="mb-1">String manipulation, various text draw functions and the font function.
                                </p>
                            </label>
                            <label class="list-group-item list-group-item-action active">
                                <input id="shapeCheckbox" class="form-check-input me-1" type="checkbox" checked hidden>
                                <h6 class="mb-1">Shape Essentials</h6>
                                <p class="mb-1">Additional shape functions.</p>
                            </label>
                            <label class="list-group-item list-group-item-action">
                                <input id="externalCheckbox" class="form-check-input me-1" type="checkbox" hidden>
                                <h6 class="mb-1">External Essentials</h6>
                                <p class="mb-1">Pushing Khan Academy to its limits..</p>
                            </label>
                        </div>
                        <hr>
                    </div>
                    <button class="btn btn-primary" id="submitButton">
                        Generate
                    </button>
                    &nbsp;           
                    <div class="form-check-inline align-middle">
                        <input class="form-check-input" type="checkbox" value="" id="minifiedCheckbox" checked>
                        <label class="form-check-label" for="minifiedCheckbox" data-bs-toggle="tooltip"
                            data-bs-placement="bottom" title="Lower file sizes and load times.">
                            Minified
                        </label>
                    </div>
                </form>
            </div>
            <div class="col-4">
                <div class="card">
                    <div class="card-header">Output</div>
                    <div class="card-body">
                        <h4 class="card-title">
                            <span id="build-type">CDN Build</span>
                            <small id="build-name" class="text-muted">Essentials</small>
                        </h4>
                        <p id="directions" class="card-text">
                            Paste the following code into your program:
                        </p>
                        <div id="code-container">
                            <pre style="overflow: hidden" id="code"><code class="language-js">// jshint ignore: start
$.ajaxSetup({ cache: true });
$.getScript('https://cdn.jsdelivr.net/gh/bhavjitChauhan/essentials@1/essentials.min.js',
    function() {
        // your code here
    }
);</code></pre>
                        </div>
                        <div class="btn-group float-end" role="group">
                            <a id="rawLink" class="btn btn-secondary btn-sm"
                                href="https://cdn.jsdelivr.net/gh/bhavjitChauhan/essentials@1/essentials.min.js"
                                target="_blank" role="button"><i class="bi bi-arrow-up-right"></i> Raw</a>
                            <button type=" button" id="copyButton" class="btn btn-secondary btn-sm">
                                <i class="bi bi-clipboard"></i> Copy
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1/prism.min.js"></script>
    <script>
        const tooltips = $('[data-bs-toggle="tooltip"]').toArray();
        tooltips.forEach(e => new bootstrap.Tooltip(e));

        const checkboxes = $('.list-group-item').toArray();
        checkboxes.forEach(checkbox => {
            $(checkbox).change(e => {
                const target = $(e.target);
                const parent = target.parent();
                if (target.is(':checked')) {
                    parent.addClass('active');
                } else {
                    parent.removeClass('active');
                }
            });
        });

        $('#alert').hide();
        $('#colorCheckbox').change(function () {
            if (!$('#colorCheckbox').is(':checked')) {
                $('#textCheckbox').prop('checked', false);
                $('#textCheckbox').trigger('change');
            }
        });
        $('#textCheckbox').change(function () {
            if ($('#textCheckbox').is(':checked')) {
                $('#colorCheckbox').prop('checked', true);
                $('#colorCheckbox').trigger('change');
            }
        });

        const copyToClipboard = str => {
            const el = document.createElement('textarea');
            el.value = str;
            el.setAttribute('readonly', '');
            el.style.position = 'absolute';
            el.style.left = '-9999px';
            document.body.appendChild(el);
            el.select();
            document.execCommand('copy');
            document.body.removeChild(el);
            $('#alert').show();
        };

        const baseURL = 'https://cdn.jsdelivr.net/combine/gh/bhavjitChauhan/Essentials@1/';
        const basePath = ',gh/bhavjitChauhan/Essentials@1/build/';
        const generateURL = path => `${baseURL}${path}` + (buildTypeSelected == 'CDN' ? '' : '-ka') + (minifiedSelected ? '.min.js' : '.js');
        const generatePath = file => `${basePath}${file}` + (buildTypeSelected == 'CDN' ? '' : '-ka') + (minifiedSelected ? '.min.js' : '.js');
        const generateCodeCDN = () => `// jshint ignore: start
$.ajaxSetup({ cache: true });
$.getScript('${URL}',
    function() {
        // your code here
    }
);`;
        const jsDelivrHeader = `/**
 * Combined by jsDelivr.
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
`;

        let buildTypeSelected = 'CDN';
        let minifiedSelected = true;
        let URL = generateURL('essentials');
        let code = null;
        $('#form').submit(e => e.preventDefault());
        $('#submitButton').click(function () {
            buildTypeSelected = $('#buildTypeSelect').val();
            minifiedSelected = $('#minifiedCheckbox').is(':checked');
            $('#build-type').text(`${buildTypeSelected} Build`);
            const components = [
                $('#colorCheckbox').is(':checked'),
                $('#textCheckbox').is(':checked'),
                $('#shapeCheckbox').is(':checked'),
                $('#externalCheckbox').is(':checked'),
            ];
            if (components.every(Boolean)) {
                URL = generateURL('build/essentials-x');
                URL = URL.replace('combine/', '');
                $('#build-name').text('Essentials X');
            } else if (components.slice(0, 3).every(Boolean) && !components[3]) {
                URL = generateURL((buildTypeSelected == 'CDN' ? '' : 'build/') + 'essentials');
                URL = URL.replace('combine/', '');
                $('#build-name').text('Essentials');
            } else {
                URL = generateURL('build/essentials-core');
                let options = [
                    generatePath('color-essentials'),
                    generatePath('text-essentials'),
                    generatePath('shape-essentials'),
                    generatePath('external-essentials')
                ];
                options = options.filter((_, i) => components[i]);
                URL += options.join('');
                if (components.every(component => !component)) {
                    $('#build-name').text('Core');
                    URL = URL.replace('combine/', '');
                } else {
                    $('#build-name').text('Custom');
                }
            }
            if (buildTypeSelected == 'CDN') {
                $('.language-js').text(generateCodeCDN());
                Prism.highlightElement(
                    document.querySelector('.language-js')
                );
                $('#code').show();
                $('#copyButton').show();
            } else {
                code = null;
                $('.language-js').text('Loading...');
                $.get(URL, (data) => {
                    let code = data.replace(jsDelivrHeader, '');
                    code = /(.*?\n){10}/g.exec(code)[0] + '. . .';
                    $('.language-js').text(code);
                });
            }
            $('#rawLink').attr('href', URL);
        });

        $('#copyButton').on('click', function () {
            if (buildTypeSelected == 'CDN') {
                copyToClipboard(generateCodeCDN());
            } else {
                copyToClipboard(code);
            }
        });
    </script>
</body>

</html>